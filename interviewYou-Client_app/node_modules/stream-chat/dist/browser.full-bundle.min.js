!function(e){"use strict";for(var t=function(e){for(var t,r=e.length,i=r%3,s=[],a=16383,c=0,u=r-i;c<u;c+=a)s.push(o(e,c,c+a>u?u:c+a));1===i?(t=e[r-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return s.join("")},n=[],r=[],i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=i.length;s<a;++s)n[s]=i[s],r[i.charCodeAt(s)]=s;function o(e,t,r){for(var i,s,a=[],o=t;o<r;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(n[(s=i)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return a.join("")}function c(e){return"string"==typeof e}function u(e,t){return t&&c(e)}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63;var l=function(e){return t(new Uint8Array(function(e,t){var n=[];if(c(e)&&u(e,t)){for(var r=0,i=e.length;r<i;r++)if(e.charAt(r)){var s=t(e.charAt(r),r,e);n[r]=s}}else if(!c(e)&&!u(e,t))for(var a=0,o=e.length;a<o;a++)if(a in e){var l=t(e[a],a,e);n[a]=l}return n}(e,(function(e){return e.charCodeAt(0)}))))},h=function(e){var t,n,r,i={},s=String.fromCharCode,a=e.length,o=0,c=0,u="";for(t=0;t<64;t++)i["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(n=0;n<a;n++)for(o=(o<<6)+i[e.charAt(n)],c+=6;c>=8;)((r=o>>>(c-=8)&255)||n<a-2)&&(u+=s(r));return u},f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function d(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var p=d((function(e){function t(){return e.exports=t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}e.exports=t})),v=d((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=t=function(e){return typeof e}:e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(n)}e.exports=t}));var g=function(e){if(Array.isArray(e))return e};var y=function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return n}};var m=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r};var b=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}};var w=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var k=function(e,t){return g(e)||y(e,t)||b(e,t)||w()};var _=function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i};var C=function(e,t){if(null==e)return{};var n,r,i=_(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i};var x=function(e){if(Array.isArray(e))return m(e)};var U=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var R=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var O=function(e){return x(e)||U(e)||b(e)||R()},S=d((function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,s=Object.create(i.prototype),a=new S(r||[]);return s._invoke=function(e,t,n){var r=h;return function(i,s){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw s;return I()}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=U(a,n);if(o){if(o===v)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var c=l(e,t,n);if("normal"===c.type){if(r=n.done?p:f,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,a),s}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",v={};function g(){}function y(){}function m(){}var b={};b[s]=function(){return this};var w=Object.getPrototypeOf,k=w&&w(w(E([])));k&&k!==n&&r.call(k,s)&&(b=k);var _=m.prototype=g.prototype=Object.create(b);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,s,a,o){var c=l(e[i],e,s);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,a,o)}),(function(e){n("throw",e,a,o)})):t.resolve(h).then((function(e){u.value=e,a(u)}),(function(e){return n("throw",e,a,o)}))}o(c.arg)}var i;this._invoke=function(e,r){function s(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(s,s):s()}}function U(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,U(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var s=i.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function E(e){if(e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}return{next:I}}function I(){return{value:t,done:!0}}return y.prototype=_.constructor=m,m.constructor=y,y.displayName=c(m,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,o,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},C(x.prototype),x.prototype[a]=function(){return this},e.AsyncIterator=x,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var a=new x(u(t,n,r,i),s);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(_),c(_,o,"Generator"),_[s]=function(){return this},_.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=E,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return o.type="throw",o.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],o=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:E(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));function E(e,t,n,r,i,s,a){try{var o=e[s](a),c=o.value}catch(e){return void n(e)}o.done?t(c):Promise.resolve(c).then(r,i)}var I=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){E(s,r,i,a,o,"next",e)}function o(e){E(s,r,i,a,o,"throw",e)}a(void 0)}))}};var A=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(e,t,n){return t&&j(e.prototype,t),n&&j(e,n),e};var D=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},T=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},P=Object.prototype.toString;function M(e){return"[object Array]"===P.call(e)}function F(e){return void 0===e}function B(e){return null!==e&&"object"==typeof e}function N(e){if("[object Object]"!==P.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function q(e){return"[object Function]"===P.call(e)}function W(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),M(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var z={isArray:M,isArrayBuffer:function(e){return"[object ArrayBuffer]"===P.call(e)},isBuffer:function(e){return null!==e&&!F(e)&&null!==e.constructor&&!F(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:B,isPlainObject:N,isUndefined:F,isDate:function(e){return"[object Date]"===P.call(e)},isFile:function(e){return"[object File]"===P.call(e)},isBlob:function(e){return"[object Blob]"===P.call(e)},isFunction:q,isStream:function(e){return B(e)&&q(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:W,merge:function e(){var t={};function n(n,r){N(t[r])&&N(n)?t[r]=e(t[r],n):N(n)?t[r]=e({},n):M(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)W(arguments[r],n);return t},extend:function(e,t,n){return W(t,(function(t,r){e[r]=n&&"function"==typeof t?T(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}};function H(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var J=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(z.isURLSearchParams(t))r=t.toString();else{var i=[];z.forEach(t,(function(e,t){null!=e&&(z.isArray(e)?t+="[]":e=[e],z.forEach(e,(function(e){z.isDate(e)?e=e.toISOString():z.isObject(e)&&(e=JSON.stringify(e)),i.push(H(t)+"="+H(e))})))})),r=i.join("&")}if(r){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e};function K(){this.handlers=[]}K.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},K.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},K.prototype.forEach=function(e){z.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var $=K,G=function(e,t,n){return z.forEach(n,(function(n){e=n(e,t)})),e},V=function(e){return!(!e||!e.__CANCEL__)},X=function(e,t){z.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},Y=function(e,t,n,r,i){return function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(new Error(e),t,n,r,i)},Q=z.isStandardBrowserEnv()?{write:function(e,t,n,r,i,s){var a=[];a.push(e+"="+encodeURIComponent(t)),z.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),z.isString(r)&&a.push("path="+r),z.isString(i)&&a.push("domain="+i),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Z=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],ee=z.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=z.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},te=function(e){return new Promise((function(t,n){var r=e.data,i=e.headers;z.isFormData(r)&&delete i["Content-Type"],(z.isBlob(r)||z.isFile(r))&&r.type&&delete i["Content-Type"];var s=new XMLHttpRequest;if(e.auth){var a=e.auth.username||"",o=unescape(encodeURIComponent(e.auth.password))||"";i.Authorization="Basic "+btoa(a+":"+o)}var c,u,l=(c=e.baseURL,u=e.url,c&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(u)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(c,u):u);if(s.open(e.method.toUpperCase(),J(l,e.params,e.paramsSerializer),!0),s.timeout=e.timeout,s.onreadystatechange=function(){if(s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in s?function(e){var t,n,r,i={};return e?(z.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=z.trim(e.substr(0,r)).toLowerCase(),n=z.trim(e.substr(r+1)),t){if(i[t]&&Z.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i):i}(s.getAllResponseHeaders()):null,i={data:e.responseType&&"text"!==e.responseType?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:r,config:e,request:s};!function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(Y("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}(t,n,i),s=null}},s.onabort=function(){s&&(n(Y("Request aborted",e,"ECONNABORTED",s)),s=null)},s.onerror=function(){n(Y("Network Error",e,null,s)),s=null},s.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(Y(t,e,"ECONNABORTED",s)),s=null},z.isStandardBrowserEnv()){var h=(e.withCredentials||ee(l))&&e.xsrfCookieName?Q.read(e.xsrfCookieName):void 0;h&&(i[e.xsrfHeaderName]=h)}if("setRequestHeader"in s&&z.forEach(i,(function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete i[t]:s.setRequestHeader(t,e)})),z.isUndefined(e.withCredentials)||(s.withCredentials=!!e.withCredentials),e.responseType)try{s.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&s.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){s&&(s.abort(),n(e),s=null)})),r||(r=null),s.send(r)}))},ne={"Content-Type":"application/x-www-form-urlencoded"};function re(e,t){!z.isUndefined(e)&&z.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var ie,se={adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(ie=te),ie),transformRequest:[function(e,t){return X(t,"Accept"),X(t,"Content-Type"),z.isFormData(e)||z.isArrayBuffer(e)||z.isBuffer(e)||z.isStream(e)||z.isFile(e)||z.isBlob(e)?e:z.isArrayBufferView(e)?e.buffer:z.isURLSearchParams(e)?(re(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):z.isObject(e)?(re(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};se.headers={common:{Accept:"application/json, text/plain, */*"}},z.forEach(["delete","get","head"],(function(e){se.headers[e]={}})),z.forEach(["post","put","patch"],(function(e){se.headers[e]=z.merge(ne)}));var ae=se;function oe(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var ce=function(e){return oe(e),e.headers=e.headers||{},e.data=G(e.data,e.headers,e.transformRequest),e.headers=z.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),z.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||ae.adapter)(e).then((function(t){return oe(e),t.data=G(t.data,t.headers,e.transformResponse),t}),(function(t){return V(t)||(oe(e),t&&t.response&&(t.response.data=G(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},ue=function(e,t){t=t||{};var n={},r=["url","method","data"],i=["headers","auth","proxy","params"],s=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],a=["validateStatus"];function o(e,t){return z.isPlainObject(e)&&z.isPlainObject(t)?z.merge(e,t):z.isPlainObject(t)?z.merge({},t):z.isArray(t)?t.slice():t}function c(r){z.isUndefined(t[r])?z.isUndefined(e[r])||(n[r]=o(void 0,e[r])):n[r]=o(e[r],t[r])}z.forEach(r,(function(e){z.isUndefined(t[e])||(n[e]=o(void 0,t[e]))})),z.forEach(i,c),z.forEach(s,(function(r){z.isUndefined(t[r])?z.isUndefined(e[r])||(n[r]=o(void 0,e[r])):n[r]=o(void 0,t[r])})),z.forEach(a,(function(r){r in t?n[r]=o(e[r],t[r]):r in e&&(n[r]=o(void 0,e[r]))}));var u=r.concat(i).concat(s).concat(a),l=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return z.forEach(l,c),n};function le(e){this.defaults=e,this.interceptors={request:new $,response:new $}}le.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=ue(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[ce,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},le.prototype.getUri=function(e){return e=ue(this.defaults,e),J(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},z.forEach(["delete","get","head","options"],(function(e){le.prototype[e]=function(t,n){return this.request(ue(n||{},{method:e,url:t}))}})),z.forEach(["post","put","patch"],(function(e){le.prototype[e]=function(t,n,r){return this.request(ue(r||{},{method:e,url:t,data:n}))}}));var he=le;function fe(e){this.message=e}fe.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},fe.prototype.__CANCEL__=!0;var de=fe;function pe(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new de(e),t(n.reason))}))}pe.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},pe.source=function(){var e;return{token:new pe((function(t){e=t})),cancel:e}};var ve=pe;function ge(e){var t=new he(e),n=T(he.prototype.request,t);return z.extend(n,he.prototype,t),z.extend(n,t),n}var ye=ge(ae);ye.Axios=he,ye.create=function(e){return ge(ue(ye.defaults,e))},ye.Cancel=de,ye.CancelToken=ve,ye.isCancel=V,ye.all=function(e){return Promise.all(e)},ye.spread=function(e){return function(t){return e.apply(null,t)}};var me=ye,be=ye;me.default=be;var we=me,ke="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),_e=new Uint8Array(16);function Ce(){if(!ke)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ke(_e)}var xe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Ue(e){return"string"==typeof e&&xe.test(e)}for(var Re=[],Oe=0;Oe<256;++Oe)Re.push((Oe+256).toString(16).substr(1));function Se(e,t,n){var r=(e=e||{}).random||(e.rng||Ce)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Re[e[t+0]]+Re[e[t+1]]+Re[e[t+2]]+Re[e[t+3]]+"-"+Re[e[t+4]]+Re[e[t+5]]+"-"+Re[e[t+6]]+Re[e[t+7]]+"-"+Re[e[t+8]]+Re[e[t+9]]+"-"+Re[e[t+10]]+Re[e[t+11]]+Re[e[t+12]]+Re[e[t+13]]+Re[e[t+14]]+Re[e[t+15]]).toLowerCase();if(!Ue(n))throw TypeError("Stringified UUID is invalid");return n}(r)}var Ee=d((function(e,t){var n;n=function e(t){var n,r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),i={use_static:!1};function s(e){var t=Object.getPrototypeOf(e);return t?Object.create(t):{}}function a(e,t,n){Object.defineProperty(e,t,{enumerable:!1,configurable:!1,writable:!1,value:n})}function o(e,t){a(e,t,(function(){throw new g("The "+t+" method cannot be invoked on an Immutable data structure.")}))}"object"!=typeof(n=t)||Array.isArray(n)||null===n||void 0!==t.use_static&&(i.use_static=Boolean(t.use_static));var c="__immutable_invariants_hold";function u(e){return"object"!=typeof e||null===e||Boolean(Object.getOwnPropertyDescriptor(e,c))}function l(e,t){return e===t||e!=e&&t!=t}function h(e){return!(null===e||"object"!=typeof e||Array.isArray(e)||e instanceof Date)}var f=["setPrototypeOf"],d=f.concat(["push","pop","sort","splice","shift","unshift","reverse"]),p=["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]),v=f.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);function g(e){this.name="MyError",this.message=e,this.stack=(new Error).stack}function y(e,t){for(var n in a(e,c,!0),t)t.hasOwnProperty(n)&&o(e,t[n]);return Object.freeze(e),e}function m(e,t){var n=e[t];a(e,t,(function(){return J(n.apply(e,arguments))}))}function b(e,t,n){var r=n&&n.deep;if(e in this&&(r&&this[e]!==t&&h(t)&&h(this[e])&&(t=J.merge(this[e],t,{deep:!0,mode:"replace"})),l(this[e],t)))return this;var i=R.call(this);return i[e]=J(t),_(i)}g.prototype=new Error,g.prototype.constructor=Error;var w=J([]);function k(e,t,n){var r=e[0];if(1===e.length)return b.call(this,r,t,n);var i,s=e.slice(1),a=this[r];if("object"==typeof a&&null!==a)i=J.setIn(a,s,t);else{var o=s[0];i=""!==o&&isFinite(o)?k.call(w,s,t):P.call(T,s,t)}if(r in this&&a===i)return this;var c=R.call(this);return c[r]=i,_(c)}function _(e){for(var t in p)p.hasOwnProperty(t)&&m(e,p[t]);i.use_static||(a(e,"flatMap",x),a(e,"asObject",O),a(e,"asMutable",R),a(e,"set",b),a(e,"setIn",k),a(e,"update",F),a(e,"updateIn",N),a(e,"getIn",q));for(var n=0,r=e.length;n<r;n++)e[n]=J(e[n]);return y(e,d)}function C(){return new Date(this.getTime())}function x(e){if(0===arguments.length)return this;var t,n=[],r=this.length;for(t=0;t<r;t++){var i=e(this[t],t,this);Array.isArray(i)?n.push.apply(n,i):n.push(i)}return _(n)}function U(e){if(void 0===e&&0===arguments.length)return this;if("function"!=typeof e){var t=Array.isArray(e)?e.slice():Array.prototype.slice.call(arguments);t.forEach((function(e,t,n){"number"==typeof e&&(n[t]=e.toString())})),e=function(e,n){return-1!==t.indexOf(n)}}var n=s(this);for(var r in this)this.hasOwnProperty(r)&&!1===e(this[r],r)&&(n[r]=this[r]);return H(n)}function R(e){var t,n,r=[];if(e&&e.deep)for(t=0,n=this.length;t<n;t++)r.push(S(this[t]));else for(t=0,n=this.length;t<n;t++)r.push(this[t]);return r}function O(e){"function"!=typeof e&&(e=function(e){return e});var t,n={},r=this.length;for(t=0;t<r;t++){var i=e(this[t],t,this),s=i[0],a=i[1];n[s]=a}return H(n)}function S(e){return!e||"object"!=typeof e||!Object.getOwnPropertyDescriptor(e,c)||e instanceof Date?e:J.asMutable(e,{deep:!0})}function E(e,t){for(var n in e)Object.getOwnPropertyDescriptor(e,n)&&(t[n]=e[n]);return t}function I(e,t){if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(e));var n,r,i=Array.isArray(e),a=t&&t.deep,o=t&&t.mode||"merge",c=t&&t.merger;function u(e,r,i){var o,u=J(r[i]),f=c&&c(e[i],u,t),d=e[i];void 0===n&&void 0===f&&e.hasOwnProperty(i)&&l(u,d)||l(d,o=void 0!==f?f:a&&h(d)&&h(u)?J.merge(d,u,t):u)&&e.hasOwnProperty(i)||(void 0===n&&(n=E(e,s(e))),n[i]=o)}function f(e,t){for(var r in e)t.hasOwnProperty(r)||(void 0===n&&(n=E(e,s(e))),delete n[r])}if(i)for(var d=0,p=e.length;d<p;d++){var v=e[d];for(r in v)v.hasOwnProperty(r)&&u(void 0!==n?n:this,v,r)}else{for(r in e)Object.getOwnPropertyDescriptor(e,r)&&u(this,e,r);"replace"===o&&f(this,e)}return void 0===n?this:H(n)}function A(e,t){var n=t&&t.deep;if(0===arguments.length)return this;if(null===e||"object"!=typeof e)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(e));return J.merge(this,e,{deep:n,mode:"replace"})}var j,L,D,T=J({});function P(e,t,n){if(!Array.isArray(e)||0===e.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var r=e[0];if(1===e.length)return M.call(this,r,t,n);var i,a=e.slice(1),o=this[r];if(i=this.hasOwnProperty(r)&&"object"==typeof o&&null!==o?J.setIn(o,a,t):P.call(T,a,t),this.hasOwnProperty(r)&&o===i)return this;var c=E(this,s(this));return c[r]=i,H(c)}function M(e,t,n){var r=n&&n.deep;if(this.hasOwnProperty(e)&&(r&&this[e]!==t&&h(t)&&h(this[e])&&(t=J.merge(this[e],t,{deep:!0,mode:"replace"})),l(this[e],t)))return this;var i=E(this,s(this));return i[e]=J(t),H(i)}function F(e,t){var n=Array.prototype.slice.call(arguments,2),r=this[e];return J.set(this,e,t.apply(r,[r].concat(n)))}function B(e,t){for(var n=0,r=t.length;null!=e&&n<r;n++)e=e[t[n]];return n&&n==r?e:void 0}function N(e,t){var n=Array.prototype.slice.call(arguments,2),r=B(this,e);return J.setIn(this,e,t.apply(r,[r].concat(n)))}function q(e,t){var n=B(this,e);return void 0===n?t:n}function W(e){var t,n=s(this);if(e&&e.deep)for(t in this)this.hasOwnProperty(t)&&(n[t]=S(this[t]));else for(t in this)this.hasOwnProperty(t)&&(n[t]=this[t]);return n}function z(){return{}}function H(e){return i.use_static||(a(e,"merge",I),a(e,"replace",A),a(e,"without",U),a(e,"asMutable",W),a(e,"set",M),a(e,"setIn",P),a(e,"update",F),a(e,"updateIn",N),a(e,"getIn",q)),y(e,f)}function J(e,t,n){if(u(e)||function(e){return"object"==typeof e&&null!==e&&(60103===e.$$typeof||e.$$typeof===r)}(e)||function(e){return"undefined"!=typeof File&&e instanceof File}(e)||function(e){return"undefined"!=typeof Blob&&e instanceof Blob}(e)||function(e){return e instanceof Error}(e))return e;if(function(e){return"object"==typeof e&&"function"==typeof e.then}(e))return e.then(J);if(Array.isArray(e))return _(e.slice());if(e instanceof Date)return s=new Date(e.getTime()),i.use_static||a(s,"asMutable",C),y(s,v);var s,o=t&&t.prototype,c=(o&&o!==Object.prototype?function(){return Object.create(o)}:z)();if(null==n&&(n=64),n<=0)throw new g("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");for(var l in n-=1,e)Object.getOwnPropertyDescriptor(e,l)&&(c[l]=J(e[l],void 0,n));return H(c)}function K(e){return function(){var t=[].slice.call(arguments),n=t.shift();return e.apply(n,t)}}function $(e,t){return function(){var n=[].slice.call(arguments),r=n.shift();return Array.isArray(r)?t.apply(r,n):e.apply(r,n)}}return J.from=J,J.isImmutable=u,J.ImmutableError=g,J.merge=K(I),J.replace=K(A),J.without=K(U),J.asMutable=(j=W,L=R,D=C,function(){var e=[].slice.call(arguments),t=e.shift();return Array.isArray(t)?L.apply(t,e):t instanceof Date?D.apply(t,e):j.apply(t,e)}),J.set=$(M,b),J.setIn=$(P,k),J.update=K(F),J.updateIn=K(N),J.getIn=K(q),J.flatMap=K(x),J.asObject=K(O),i.use_static||(J.static=e({use_static:!0})),Object.freeze(J),J}(),e.exports=n}));function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var je=function(){function e(t){var n;A(this,e),D(this,"_channel",void 0),D(this,"watcher_count",void 0),D(this,"typing",void 0),D(this,"read",void 0),D(this,"messages",void 0),D(this,"threads",void 0),D(this,"mutedUsers",void 0),D(this,"watchers",void 0),D(this,"members",void 0),D(this,"unreadCount",void 0),D(this,"membership",void 0),D(this,"last_message_at",void 0),D(this,"removeMessageFromArray",(function(e,t){var n=e.filter((function(e){return!(e.id&&t.id&&e.id===t.id)}));return{removed:n.length<e.length,result:n}})),this._channel=t,this.watcher_count=0,this.typing=Ee({}),this.read=Ee({}),this.messages=Ee([]),this.threads=Ee({}),this.mutedUsers=Ee([]),this.watchers=Ee({}),this.members=Ee({}),this.membership=Ee({}),this.unreadCount=0,this.last_message_at=null!=(null==t||null===(n=t.state)||void 0===n?void 0:n.last_message_at)?new Date(t.state.last_message_at):null}return L(e,[{key:"addMessageSorted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.addMessagesSorted([e],t)}},{key:"messageToImmutable",value:function(e){return Ee(Ae(Ae({},e),{},{__html:e.html,created_at:e.created_at?new Date(e.created_at):new Date,updated_at:e.updated_at?new Date(e.updated_at):new Date,status:e.status||"received"}))}},{key:"addMessagesSorted",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<e.length;r+=1){var i=this.messageToImmutable(e[r]);n&&i.id&&this.threads[i.id]&&(this.threads=this.threads.without(i.id)),this.last_message_at||(this.last_message_at=new Date(i.created_at.getTime())),i.created_at.getTime()>this.last_message_at.getTime()&&(this.last_message_at=new Date(i.created_at.getTime()));var s=i.parent_id;if(s&&!i.show_in_channel||(this.messages=this._addToMessageList(this.messages,i,t)),s){var a=this.threads[s]||Ee([]),o=this._addToMessageList(a,i,t);this.threads=this.threads.set(s,o)}}}},{key:"addReaction",value:function(e,t){var n=this.messages;if(t){var r=t.parent_id,i=t.show_in_channel;if(r&&this.threads[r])for(var s=this.threads[r],a=0;a<s.length;a++){var o=s[a],c=this._addReactionToMessage(o,e);if(c){this.threads=this.threads.set(r,s.set(a,c));break}}if(!i&&!r||i)for(var u=0;u<n.length;u++){var l=n[u],h=this._addReactionToMessage(l,e);if(h){this.messages=n.set(u,h);break}}}}},{key:"_addReactionToMessage",value:function(e,t){var n;if(!(!!e.id&&e.id===t.message_id))return!1;var r=this._removeReactionFromMessage(e,t);return this._channel.getClient().userID===(null===(n=t.user)||void 0===n?void 0:n.id)&&(r=r.update("own_reactions",(function(e){return e.concat([t])}))),r=(r=r.update("latest_reactions",(function(e){return e.concat([t])}))).updateIn(["reaction_counts",t.type],(function(e){return e?e+1:1}))}},{key:"_removeReactionFromMessage",value:function(e,t){var n=function(e){return e.filter((function(e){var n,r;return e.type!==t.type||(null===(n=e.user)||void 0===n?void 0:n.id)!==(null===(r=t.user)||void 0===r?void 0:r.id)}))},r=e.update("own_reactions",n);return r=r.update("latest_reactions",n)}},{key:"removeReaction",value:function(e,t){var n=this.messages;if(t){var r=t.parent_id,i=t.show_in_channel;if(r&&this.threads[r])for(var s=this.threads[r],a=0;a<s.length;a++){var o=s[a];if(!!o.id&&o.id===e.message_id){var c=this._removeReactionFromMessage(o,e);c=c.updateIn(["reaction_counts",e.type],(function(e){return e?e-1:0})),this.threads=this.threads.set(r,s.set(a,c));break}}if(!i&&!r||i)for(var u=0;u<n.length;u++){var l=n[u];if(!!l.id&&l.id===e.message_id){var h=this._removeReactionFromMessage(l,e);h=h.updateIn(["reaction_counts",e.type],(function(e){return e?e-1:0})),this.messages=n.set(u,h);break}}}}},{key:"_addToMessageList",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e;if(n&&(r=r.filter((function(e){return!(e.id&&t.id===e.id)}))),0===r.length)return r.concat(t);var i=t.created_at.getTime();if(r[r.length-1].created_at.getTime()<i)return r.concat(t);for(var s=0,a=0,o=r.length-1;s<=o;)r[a=Math.floor((o+s)/2)].created_at.getTime()<=i?s=a+1:o=a-1;if(!n&&t.id){if(r[s]&&t.id===r[s].id)return r.set(s,t);if(r[s-1]&&t.id===r[s-1].id)return r.set(s-1,t)}var c=r.asMutable();return c.splice(s,0,t),Ee(c)}},{key:"removeMessage",value:function(e){var t=!1;if(e.parent_id&&this.threads[e.parent_id]){var n=this.removeMessageFromArray(this.threads[e.parent_id],e),r=n.removed,i=n.result;this.threads=this.threads[e.parent_id].set(e.parent_id,i),t=r}else{var s=this.removeMessageFromArray(this.messages,e),a=s.removed,o=s.result;this.messages=o,t=a}return t}},{key:"filterErrorMessages",value:function(){var e=this.messages.filter((function(e){return"error"!==e.type}));this.messages=e}},{key:"clean",value:function(){for(var e=new Date,t=0,n=Object.entries(this.typing);t<n.length;t++){var r=k(n[t],2),i=r[0],s=r[1];("string"==typeof s.received_at&&e.getTime()-new Date(s.received_at).getTime())>7e3&&(this.typing=this.typing.without(i),this._channel.getClient().dispatchEvent({type:"typing.stop",user:{id:i},cid:this._channel.cid}))}}},{key:"clearMessages",value:function(){this.messages=Ee([])}}]),e}();function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Te={"channel.created":!0,"channel.deleted":!0,"channel.hidden":!0,"channel.muted":!0,"channel.truncated":!0,"channel.unmuted":!0,"channel.updated":!0,"channel.visible":!0,"health.check":!0,"member.added":!0,"member.removed":!0,"member.updated":!0,"message.deleted":!0,"message.new":!0,"message.read":!0,"message.updated":!0,"notification.added_to_channel":!0,"notification.channel_deleted":!0,"notification.channel_mutes_updated":!0,"notification.channel_truncated":!0,"notification.invite_accepted":!0,"notification.invited":!0,"notification.mark_read":!0,"notification.message_new":!0,"notification.mutes_updated":!0,"notification.removed_from_channel":!0,"reaction.deleted":!0,"reaction.new":!0,"reaction.updated":!0,"typing.start":!0,"typing.stop":!0,"user.banned":!0,"user.deleted":!0,"user.presence.changed":!0,"user.unbanned":!0,"user.updated":!0,"user.watching.start":!0,"user.watching.stop":!0,"connection.changed":!0,"connection.recovered":!0},Pe=De(De({},Te),{},{all:!0}),Me=function(e){return Pe[e]||!1},Fe="object"==typeof self?self.FormData:window.FormData;function Be(e,t){e.then().catch((function(e){console.warn("failed to do ".concat(t,", ran into error: "),e)}))}var Ne=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function qe(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}var We={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function ze(e,t,n){var r,i=new Fe,s={};return t&&(s.filename=t),n&&(s.contentType=n),null!==(r=e)&&"object"===v(r)&&(r.readable||"function"==typeof r._read)||function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}(e)||function(e){return"undefined"!=typeof window&&"File"in window&&e instanceof File}(e)?i.append("file",e,s):i.append("file",{uri:e,name:t||e.split("/").reverse()[0],contentType:n||void 0,type:n||void 0}),i}function He(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Je(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ge=function(){function e(t,n,r,i){var s=this;A(this,e),D(this,"_client",void 0),D(this,"type",void 0),D(this,"id",void 0),D(this,"data",void 0),D(this,"_data",void 0),D(this,"cid",void 0),D(this,"listeners",void 0),D(this,"state",void 0),D(this,"initialized",void 0),D(this,"lastKeyStroke",void 0),D(this,"lastTypingEvent",void 0),D(this,"isTyping",void 0),D(this,"disconnected",void 0),D(this,"create",I(S.mark((function e(){var t;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={watch:!1,state:!1,presence:!1},e.next=3,s.query(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))),D(this,"_callChannelListeners",(function(e){var t=s,n=[];t.listeners.all&&n.push.apply(n,O(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,O(t.listeners[e.type]));for(var r=0,i=n;r<i.length;r++){var a=i[r];"string"!=typeof a&&a(e)}})),D(this,"_channelURL",(function(){if(!s.id)throw new Error("channel id is not defined");return"".concat(s.getClient().baseURL,"/channels/").concat(s.type,"/").concat(s.id)}));if(!/^[\w_-]+$/.test(n))throw new Error("Invalid chat type ".concat(n,', letters, numbers and "_-" are allowed'));if("string"==typeof r&&!/^[\w!_-]+$/.test(r))throw new Error("Invalid chat id ".concat(r,', letters, numbers and "!-_" are allowed'));this._client=t,this.type=n,this.id=r,this.data=i,this._data=$e({},i),this.cid="".concat(n,":").concat(r),this.listeners={},this.state=new je(this),this.initialized=!1,this.lastTypingEvent=null,this.isTyping=!1,this.disconnected=!1}var t,n,r,i,s,a,o,c,u,l,h,f,d,g,y,m,b,w,_,C,x,U,R,E,j,T,P,M,F,B;return L(e,[{key:"getClient",value:function(){if(!0===this.disconnected)throw Error("You can't use a channel after client.disconnect() was called");return this._client}},{key:"getConfig",value:function(){return this.getClient().configs[this.type]}},{key:"sendMessage",value:(B=I(S.mark((function e(t){var n;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/message",{message:t});case 2:return n=e.sent,this.state.unreadCount=0,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"sendFile",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/file"),e,t,n,r)}},{key:"sendImage",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/image"),e,t,n,r)}},{key:"deleteFile",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/file"),{url:e})}},{key:"deleteImage",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/image"),{url:e})}},{key:"sendEvent",value:(F=I(S.mark((function e(t){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().post(this._channelURL()+"/event",{event:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"search",value:(M=I(S.mark((function e(t){var n,r,i=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=$e({filter_conditions:{cid:this.cid}},n),"string"!=typeof t){e.next=6;break}r.query=t,e.next=11;break;case 6:if("object"!==v(t)){e.next=10;break}r.message_filter_conditions=t,e.next=11;break;case 10:throw Error("Invalid type ".concat(v(t)," for query parameter"));case 11:return e.next=13,this.getClient().wsPromise;case 13:return e.next=15,this.getClient().get(this.getClient().baseURL+"/search",{payload:r});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"queryMembers",value:(P=I(S.mark((function e(t){var n,r,i,s,a,o,c,u,l,h,f,d,p=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=p.length>1&&void 0!==p[1]?p[1]:{},i=p.length>2&&void 0!==p[2]?p[2]:{},s=[],a=0,o=Object.entries(r);a<o.length;a++)c=k(o[a],2),u=c[0],l=c[1],s.push({field:u,direction:l});return f=this.type,this.id?h=this.id:(null===(n=this.data)||void 0===n?void 0:n.members)&&Array.isArray(this.data.members)&&(d=this.data.members),e.next=8,this.getClient().get(this.getClient().baseURL+"/members",{payload:$e({type:f,id:h,members:d,sort:s,filter_conditions:t},i)});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"sendReaction",value:(T=I(S.mark((function e(t,n,r){var i;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Message id is missing");case 2:if(n&&0!==Object.keys(n).length){e.next=4;break}throw Error("Reaction object is missing");case 4:return i={reaction:n},null!=r&&(i.reaction=$e($e({},n),{},{user:{id:r}})),e.next=8,this.getClient().post(this.getClient().baseURL+"/messages/".concat(t,"/reaction"),i);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return T.apply(this,arguments)})},{key:"deleteReaction",value:function(e,t,n){if(this._checkInitialized(),!t||!e)throw Error("Deleting a reaction requires specifying both the message and reaction type");var r=this.getClient().baseURL+"/messages/".concat(e,"/reaction/").concat(t);return n?this.getClient().delete(r,{user_id:n}):this.getClient().delete(r,{})}},{key:"update",value:(j=I(S.mark((function e(){var t,n,r,i=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=i.length>1?i[1]:void 0,["config","cid","created_by","id","member_count","type","created_at","updated_at","last_message_at"].forEach((function(e){delete t[e]})),e.next=6,this.getClient().post(this._channelURL(),{message:n,data:t});case 6:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"enableSlowMode",value:(E=I(S.mark((function e(t){var n;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:t});case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"disableSlowMode",value:(R=I(S.mark((function e(){var t;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:0});case 2:return t=e.sent,this.data=t.channel,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"delete",value:(U=I(S.mark((function e(){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().delete(this._channelURL(),{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"truncate",value:(x=I(S.mark((function e(){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/truncate",{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"acceptInvite",value:(C=I(S.mark((function e(){var t,n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getClient().post(this._channelURL(),$e({accept_invite:!0},t));case 3:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"rejectInvite",value:(_=I(S.mark((function e(){var t,n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.getClient().post(this._channelURL(),$e({reject_invite:!0},t));case 3:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"addMembers",value:(w=I(S.mark((function e(t,n){var r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{add_members:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"addModerators",value:(b=I(S.mark((function e(t,n){var r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{add_moderators:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"inviteMembers",value:(m=I(S.mark((function e(t,n){var r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{invites:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"removeMembers",value:(y=I(S.mark((function e(t,n){var r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{remove_members:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"demoteModerators",value:(g=I(S.mark((function e(t,n){var r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{demote_moderators:t,message:n});case 2:return r=e.sent,this.data=r.channel,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"mute",value:(d=I(S.mark((function e(){var t,n=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/mute/channel",$e({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"unmute",value:(f=I(S.mark((function e(){var t,n=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/unmute/channel",$e({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"muteStatus",value:function(){return this._checkInitialized(),this.getClient()._muteStatus(this.cid)}},{key:"sendAction",value:function(e,t){if(this._checkInitialized(),!e)throw Error("Message id is missing");return this.getClient().post(this.getClient().baseURL+"/messages/".concat(e,"/action"),{message_id:e,form_data:t,id:this.id,type:this.type})}},{key:"keystroke",value:(h=I(S.mark((function e(t){var n,r,i;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=this.getConfig())||void 0===n?void 0:n.typing_events){e.next=2;break}return e.abrupt("return");case 2:if(r=new Date,i=this.lastTypingEvent&&r.getTime()-this.lastTypingEvent.getTime(),this.lastKeyStroke=r,this.isTyping=!0,!(null===i||i>2e3)){e.next=10;break}return this.lastTypingEvent=new Date,e.next=10,this.sendEvent({parent_id:t,type:"typing.start"});case 10:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"stopTyping",value:(l=I(S.mark((function e(){var t;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.getConfig())||void 0===t?void 0:t.typing_events){e.next=2;break}return e.abrupt("return");case 2:return this.lastTypingEvent=null,this.isTyping=!1,e.next=6,this.sendEvent({type:"typing.stop"});case 6:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"lastMessage",value:function(){var e=this.state.messages.length-5;e<0&&(e=0);var t,n=this.state.messages.length+1,r=this.state.messages.slice(e,n).asMutable();return r.sort((function(e,t){return t.created_at.getTime()-e.created_at.getTime()})),r.length>0&&(t=r[0]),t}},{key:"markRead",value:(u=I(S.mark((function e(){var t,n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>0&&void 0!==r[0]?r[0]:{},this._checkInitialized(),null===(t=this.getConfig())||void 0===t?void 0:t.read_events){e.next=4;break}return e.abrupt("return",Promise.resolve(null));case 4:return e.next=6,this.getClient().post(this._channelURL()+"/read",$e({},n));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"clean",value:function(){this.lastKeyStroke&&((new Date).getTime()-this.lastKeyStroke.getTime()>1e3&&this.isTyping&&Be(this.stopTyping(),"stop typing event"));this.state.clean()}},{key:"watch",value:(c=I(S.mark((function e(t){var n,r,i;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={state:!0,watch:!0,presence:!1},e.next=3,this.getClient().wsPromise;case 3:return this.getClient()._hasConnectionID()||(n.watch=!1),r=$e($e({},n),t),e.next=7,this.query(r);case 7:return i=e.sent,this.initialized=!0,this._initializeState(i),this.data=i.channel,this._client.logger("info","channel:watch() - started watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"stopWatching",value:(o=I(S.mark((function e(){var t;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/stop-watching",{});case 2:return t=e.sent,this._client.logger("info","channel:watch() - stopped watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getReplies",value:(a=I(S.mark((function e(t,n){var r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().get(this.getClient().baseURL+"/messages/".concat(t,"/replies"),$e({},n));case 2:return(r=e.sent).messages&&this.state.addMessagesSorted(r.messages),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"getReactions",value:function(e,t){return this.getClient().get(this.getClient().baseURL+"/messages/".concat(e,"/reactions"),$e({},t))}},{key:"getMessagesById",value:function(e){return this.getClient().get(this._channelURL()+"/messages",{ids:e.join(",")})}},{key:"lastRead",value:function(){this._checkInitialized();var e=this.getClient().userID;if(e)return this.state.read[e]?this.state.read[e].last_read:null}},{key:"countUnread",value:function(e){if(!e)return this.state.unreadCount;var t,n=0,r=He(this.state.messages.asMutable());try{for(r.s();!(t=r.n()).done;){var i,s=t.value,a=s.asMutable({deep:!0});this.getClient().userID!==(null===(i=a.user)||void 0===i?void 0:i.id)&&(s.silent||(null!=e?s.created_at>e&&n++:n++))}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"countUnreadMentions",value:function(){var e,t=this,n=this.lastRead(),r=0,i=He(this.state.messages.asMutable());try{for(i.s();!(e=i.n()).done;){var s,a=e.value,o=a.asMutable({deep:!0});this.getClient().userID!==(null===(s=o.user)||void 0===s?void 0:s.id)&&(a.silent||(null!=n?a.created_at>n&&function(){var e,n=t.getClient().userID;-1!==(null===(e=a.mentioned_users)||void 0===e?void 0:e.findIndex((function(e){return e.id===n})))&&r++}():r++))}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"query",value:(s=I(S.mark((function e(t){var n,r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().wsPromise;case 2:return n="".concat(this.getClient().baseURL,"/channels/").concat(this.type),this.id&&(n+="/".concat(this.id)),e.next=6,this.getClient().post(n+"/query",$e({data:this._data,state:!0},t));case 6:return r=e.sent,this.id||(this.id=r.channel.id,this.cid=r.channel.cid,this.cid in this.getClient().activeChannels||(this.getClient().activeChannels[this.cid]=this)),this.getClient()._addChannelConfig(r),this._initializeState(r),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"banUser",value:(i=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().banUser(t,$e($e({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"hide",value:(r=I(S.mark((function e(){var t,n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1&&void 0!==r[1]&&r[1],this._checkInitialized(),e.next=5,this.getClient().post("".concat(this._channelURL(),"/hide"),{user_id:t,clear_history:n});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"show",value:(n=I(S.mark((function e(){var t,n=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,this._checkInitialized(),e.next=4,this.getClient().post("".concat(this._channelURL(),"/show"),{user_id:t});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"unbanUser",value:(t=I(S.mark((function e(t){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().unbanUser(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"on",value:function(e,t){var n=t?e:"all";if(!Me(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Attaching listener for ".concat(n," event on channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n].push(r)}},{key:"off",value:function(e,t){var n=t?e:"all";if(!Me(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Removing listener for ".concat(n," event from channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n]=this.listeners[n].filter((function(e){return e!==r}))}},{key:"_handleChannelEvent",value:function(e){var t,n,r,i,s,a,o,c,u,l=this;this._client.logger("info","channel:_handleChannelEvent - Received event of type { ".concat(e.type," } on ").concat(this.cid),{tags:["event","channel"],channel:this});var h=l.state;switch(e.type){case"typing.start":(null===(t=e.user)||void 0===t?void 0:t.id)&&(h.typing=h.typing.set(e.user.id,Ee(e)));break;case"typing.stop":(null===(n=e.user)||void 0===n?void 0:n.id)&&(h.typing=h.typing.without(e.user.id));break;case"message.read":var f,d;if(null===(r=e.user)||void 0===r?void 0:r.id)h.read=h.read.set(e.user.id,Ee({user:$e({},e.user),last_read:e.received_at})),(null===(f=e.user)||void 0===f?void 0:f.id)===(null===(d=this.getClient().user)||void 0===d?void 0:d.id)&&(h.unreadCount=0);break;case"user.watching.start":case"user.updated":(null===(i=e.user)||void 0===i?void 0:i.id)&&(h.watchers=h.watchers.set(e.user.id,Ee(e.user)));break;case"user.watching.stop":(null===(s=e.user)||void 0===s?void 0:s.id)&&(h.watchers=h.watchers.without(e.user.id));break;case"message.deleted":e.message&&(e.hard_delete?h.removeMessage(e.message):h.addMessageSorted(e.message));break;case"message.new":(null===(a=e.user)||void 0===a?void 0:a.id)===(null===(o=this.getClient().user)||void 0===o?void 0:o.id)?h.unreadCount=0:h.unreadCount=h.unreadCount+1,e.message&&h.addMessageSorted(e.message);break;case"message.updated":e.message&&h.addMessageSorted(e.message);break;case"channel.truncated":h.clearMessages();break;case"member.added":case"member.updated":var p;if(null===(c=e.member)||void 0===c?void 0:c.user_id)h.members=h.members.set(null===(p=e.member)||void 0===p?void 0:p.user_id,Ee(e.member));break;case"member.removed":(null===(u=e.user)||void 0===u?void 0:u.id)&&(h.members=h.members.without(e.user.id));break;case"channel.updated":e.channel&&(l.data=Ee(e.channel));break;case"reaction.new":e.reaction&&h.addReaction(e.reaction,e.message);break;case"reaction.deleted":e.reaction&&h.removeReaction(e.reaction,e.message);break;case"channel.hidden":e.clear_history&&h.clearMessages()}void 0!==e.watcher_count&&(l.state.watcher_count=e.watcher_count)}},{key:"_checkInitialized",value:function(){if(!this.initialized&&!this.getClient()._isUsingServerAuth())throw Error("Channel ".concat(this.cid," hasn't been initialized yet. Make sure to call .watch() and wait for it to resolve"))}},{key:"_initializeState",value:function(e){if(e.members){var t,n=He(e.members);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.user&&this.getClient().state.updateUserReference(r.user,this.cid)}}catch(e){n.e(e)}finally{n.f()}}this.state.membership=Ee(e.membership?e.membership:{});var i=e.messages||[];if(this.state.messages||(this.state.messages=Ee([])),this.state.addMessagesSorted(i,!1,!0),this.state.watcher_count=e.watcher_count?e.watcher_count:0,e.watchers){var s,a=He(e.watchers);try{for(a.s();!(s=a.n()).done;){var o=s.value;o&&(this.getClient().state.updateUserReference(o,this.cid),this.state.watchers=this.state.watchers.set(o.id,o))}}catch(e){a.e(e)}finally{a.f()}}if(null!=this.getClient().userID){var c=null!=this.state.last_message_at?this.state.last_message_at:new Date,u=this.getClient().user;u&&(this.state.read=this.state.read.set(u.id,{user:this.getClient().user,last_read:c}))}if(e.read){var l,h=He(e.read);try{for(h.s();!(l=h.n()).done;){var f,d=l.value,v=p($e({},d));v.last_read=new Date(d.last_read),this.state.read=this.state.read.set(d.user.id,v),d.user.id===(null===(f=this.getClient().user)||void 0===f?void 0:f.id)&&(this.state.unreadCount=v.unread_messages)}}catch(e){h.e(e)}finally{h.f()}}if(e.members){var g,y=He(e.members);try{for(y.s();!(g=y.n()).done;){var m=g.value;m.user&&(this.state.members=this.state.members.set(m.user.id,m))}}catch(e){y.e(e)}finally{y.f()}}}},{key:"_disconnect",value:function(){this._client.logger("info","channel:disconnect() - Disconnecting the channel ".concat(this.cid),{tags:["connection","channel"],channel:this}),this.disconnected=!0}}]),e}();function Ve(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xe(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ye=function(){function e(){A(this,e),D(this,"users",void 0),D(this,"userChannelReferences",void 0),this.users=Ee({}),this.userChannelReferences={}}return L(e,[{key:"updateUsers",value:function(e){var t,n=Ve(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.updateUser(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"updateUser",value:function(e){null!=e&&(this.users=this.users.set(e.id,Ee(e)))}},{key:"updateUserReference",value:function(e,t){null!=e&&(this.updateUser(e),this.userChannelReferences[e.id]||(this.userChannelReferences[e.id]={}),this.userChannelReferences[e.id][t]=!0)}}]),e}(),Qe=null;"undefined"!=typeof WebSocket?Qe=WebSocket:"undefined"!=typeof MozWebSocket?Qe=MozWebSocket:void 0!==f?Qe=f.WebSocket||f.MozWebSocket:"undefined"!=typeof window?Qe=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(Qe=self.WebSocket||self.MozWebSocket);var Ze=Qe,et=function(e){return void 0!==e.code},tt=function(e){return void 0!==e.error},nt=function(){function e(t){var n=this,r=t.apiKey,i=t.authType,s=t.clientID,a=t.eventCallback,o=t.logger,c=t.messageCallback,u=t.recoverCallback,l=t.tokenManager,h=t.user,f=t.userAgent,d=t.userID,p=t.wsBaseURL;A(this,e),D(this,"apiKey",void 0),D(this,"authType",void 0),D(this,"clientID",void 0),D(this,"eventCallback",void 0),D(this,"logger",void 0),D(this,"messageCallback",void 0),D(this,"recoverCallback",void 0),D(this,"tokenManager",void 0),D(this,"user",void 0),D(this,"userAgent",void 0),D(this,"userID",void 0),D(this,"wsBaseURL",void 0),D(this,"connectionID",void 0),D(this,"connectionOpen",void 0),D(this,"consecutiveFailures",void 0),D(this,"healthCheckInterval",void 0),D(this,"healthCheckIntervalRef",void 0),D(this,"isConnecting",void 0),D(this,"isHealthy",void 0),D(this,"isResolved",void 0),D(this,"lastEvent",void 0),D(this,"monitorInterval",void 0),D(this,"monitorIntervalRef",void 0),D(this,"rejectPromise",void 0),D(this,"resolvePromise",void 0),D(this,"totalFailures",void 0),D(this,"ws",void 0),D(this,"wsID",void 0),D(this,"_buildUrl",(function(){var e={user_id:n.user.id,user_details:n.user,user_token:n.tokenManager.getToken(),server_determines_connection_id:!0},t=encodeURIComponent(JSON.stringify(e)),r=n.tokenManager.getToken();return"".concat(n.wsBaseURL,"/connect?json=").concat(t,"&api_key=").concat(n.apiKey,"&authorization=").concat(r,"&stream-auth-type=").concat(n.authType,"&x-stream-client=").concat(n.userAgent)})),D(this,"onlineStatusChanged",(function(e){"offline"===e.type?(n.logger("info","connection:onlineStatusChanged() - Status changing to offline",{tags:["connection"]}),n._setHealth(!1)):"online"===e.type&&(n.logger("info","connection:onlineStatusChanged() - Status changing to online. isHealthy: ".concat(n.isHealthy),{tags:["connection"]}),n.isHealthy||n._reconnect({interval:10}))})),D(this,"onopen",(function(e){n.wsID===e&&(n.logger("info","connection:onopen() - onopen callback",{tags:["connection"],wsID:e}),n._setHealth(!0))})),D(this,"onmessage",(function(e,t){if(n.wsID===e){if(!n.isResolved&&"string"==typeof t.data){var r,i,s=JSON.parse(t.data);if(null!=s.error)return void(null===(r=n.rejectPromise)||void 0===r||r.call(n,n._errorFromWSEvent(s,!1)));null===(i=n.resolvePromise)||void 0===i||i.call(n,t)}n.lastEvent=new Date,n.logger("info","connection:onmessage() - onmessage callback",{tags:["connection"],event:t,wsID:e}),n.messageCallback(t)}})),D(this,"onclose",(function(e,t){if(n.logger("info","connection:onclose() - onclose callback - "+t.code,{tags:["connection"],event:t,wsID:e}),n.wsID===e)if(t.code===We.WS_CLOSED_SUCCESS){var r,i=new Error("WS connection reject with error ".concat(t.reason));i.reason=t.reason,null===(r=n.rejectPromise)||void 0===r||r.call(n,i),n.logger("info","connection:onclose() - WS connection reject with error ".concat(t.reason),{tags:["connection"],event:t})}else{var s;n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),null===(s=n.rejectPromise)||void 0===s||s.call(n,n._errorFromWSEvent(t)),n.logger("info","connection:onclose() - WS connection closed. Calling reconnect ...",{tags:["connection"],event:t}),n._reconnect()}})),D(this,"onerror",(function(e,t){var r;n.wsID===e&&(n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),null===(r=n.rejectPromise)||void 0===r||r.call(n,n._errorFromWSEvent(t)),n.logger("info","connection:onerror() - WS connection resulted into error",{tags:["connection"],event:t}),n._reconnect())})),D(this,"_setHealth",(function(e){e&&!n.isHealthy&&(n.isHealthy=!0,n.eventCallback({type:"connection.changed",online:!0})),!e&&n.isHealthy&&(n.isHealthy=!1,setTimeout((function(){n.isHealthy||n.eventCallback({type:"connection.changed",online:!1})}),5e3))})),D(this,"_errorFromWSEvent",(function(e){var t,r,i,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];et(e)&&(t=e.code,r="unknown",i=e.reason),tt(e)&&(t=e.error.code,r=e.error.StatusCode,i=e.error.message),n.logger("warn","connection:_errorFromWSEvent() - WS failed with code ".concat(t),{tags:["connection"],event:e});var a=new Error("WS failed with code ".concat(t," and reason - ").concat(i));return a.code=t,a.StatusCode=r,a.isWSFailure=s,a})),D(this,"_listenForConnectionChanges",(function(){"undefined"!=typeof window&&null!=window&&null!=window.addEventListener&&(window.addEventListener("offline",n.onlineStatusChanged),window.addEventListener("online",n.onlineStatusChanged))})),D(this,"_removeConnectionListeners",(function(){"undefined"!=typeof window&&null!=window&&null!=window.addEventListener&&(window.removeEventListener("offline",n.onlineStatusChanged),window.removeEventListener("online",n.onlineStatusChanged))})),D(this,"_retryInterval",(function(){var e=Math.min(500+2e3*n.consecutiveFailures,25e3),t=Math.min(Math.max(250,2e3*(n.consecutiveFailures-1)),25e3);return Math.floor(Math.random()*(e-t)+t)})),D(this,"_setupConnectionPromise",(function(){var e=n;n.isResolved=!1,n.connectionOpen=new Promise((function(t,n){e.resolvePromise=t,e.rejectPromise=n})).then((function(e){if(e.data&&"string"==typeof e.data){var t=JSON.parse(e.data);if(t&&null!=t.error)throw new Error(JSON.stringify(t.error));return t}}),(function(e){throw e}))})),this.wsBaseURL=p,this.clientID=s,this.userID=d,this.user=h,this.authType=i,this.userAgent=f,this.apiKey=r,this.tokenManager=l,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isHealthy=!1,this.recoverCallback=u,this.messageCallback=c,this.eventCallback=a,this.logger=o,this.wsID=1,this.lastEvent=null,this.healthCheckInterval=3e4,this.monitorInterval=1e3,this._listenForConnectionChanges()}var t,n,r;return L(e,[{key:"connect",value:(r=I(S.mark((function e(){var t;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isConnecting){e.next=2;break}throw Error("You've called connect twice, can only attempt 1 connection at the time");case 2:return e.prev=2,this.isConnecting=!0,e.next=6,this._connect();case 6:return t=e.sent,this.isConnecting=!1,this.consecutiveFailures=0,this._startMonitor(),this._startHealthCheck(),this.logger("info","connection:connect() - Established ws connection with healthcheck: ".concat(t),{tags:["connection"]}),e.abrupt("return",t);case 15:if(e.prev=15,e.t0=e.catch(2),this.isConnecting=!1,this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==We.TOKEN_EXPIRED||this.tokenManager.isStatic()){e.next=23;break}return this.logger("info","connection:connect() - WS failure due to expired token, so going to try to reload token and reconnect",{tags:["connection"]}),e.abrupt("return",this._reconnect({refreshToken:!0}));case 23:if(e.t0.isWSFailure){e.next=25;break}throw new Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 25:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(){return r.apply(this,arguments)})},{key:"disconnect",value:function(e){var t,n=this;this.logger("info","connection:disconnect() - Closing the websocket connection for wsID ".concat(this.wsID),{tags:["connection"]}),this.wsID+=1,this.healthCheckIntervalRef&&clearInterval(this.healthCheckIntervalRef),this.monitorIntervalRef&&clearInterval(this.monitorIntervalRef),this._removeConnectionListeners(),this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();var r=this.ws;return r&&r.close&&r.readyState===r.OPEN?(t=new Promise((function(t){var i=function(e){n.logger("info","connection:disconnect() - resolving isClosedPromise ".concat(e?"with":"without"," close frame"),{tags:["connection"],event:e}),t()};r.onclose=i,setTimeout(i,null!=e?e:1e3)})),this.logger("info","connection:disconnect() - Manually closed connection by calling client.disconnect()",{tags:["connection"]}),r.close(We.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this.logger("info","connection:disconnect() - ws connection doesn't exist or it is already closed.",{tags:["connection"]}),t=Promise.resolve()),delete this.ws,t}},{key:"_connect",value:(n=I(S.mark((function e(){var t,n;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tokenManager.tokenReady();case 2:return this._setupConnectionPromise(),t=this._buildUrl(),this.ws=new Ze(t),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID),e.next=11,this.connectionOpen;case 11:if(!(n=e.sent)){e.next=15;break}return this.connectionID=n.connection_id,e.abrupt("return",n);case 15:return e.abrupt("return",void 0);case 16:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_reconnect",value:(t=I(S.mark((function e(){var t,n,r,i=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},this.logger("info","connection:_reconnect() - Initiating the reconnect",{tags:["connection"]}),!this.isConnecting&&!this.isHealthy){e.next=5;break}return this.logger("info","connection:_reconnect() - Abort (1) since already connecting or healthy",{tags:["connection"]}),e.abrupt("return");case 5:return(n=t.interval)||(n=this._retryInterval()),e.next=9,Ne(n);case 9:if(!this.isConnecting&&!this.isHealthy){e.next=12;break}return this.logger("info","connection:_reconnect() - Abort (2) since already connecting or healthy",{tags:["connection"]}),e.abrupt("return");case 12:if(this.isConnecting=!0,this.logger("info","connection:_reconnect() - Destroying current WS connection",{tags:["connection"]}),this._destroyCurrentWSConnection(),!t.refreshToken){e.next=18;break}return e.next=18,this.tokenManager.loadToken();case 18:return e.prev=18,e.next=21,this._connect();case 21:if(r=e.sent,!this.recoverCallback){e.next=27;break}return this.logger("info","connection:_reconnect() - Waiting for recoverCallBack",{tags:["connection"]}),e.next=26,this.recoverCallback(r);case 26:this.logger("info","connection:_reconnect() - Finished recoverCallBack",{tags:["connection"]});case 27:this.isConnecting=!1,this.consecutiveFailures=0,e.next=40;break;case 31:if(e.prev=31,e.t0=e.catch(18),this.isConnecting=!1,this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==We.TOKEN_EXPIRED||this.tokenManager.isStatic()){e.next=39;break}return this.logger("info","connection:_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect",{tags:["connection"]}),e.abrupt("return",this._reconnect({refreshToken:!0}));case 39:e.t0.isWSFailure&&(this.logger("info","connection:_reconnect() - WS failure, so going to try to reconnect",{tags:["connection"]}),this._reconnect());case 40:this.logger("info","connection:_reconnect() - == END ==",{tags:["connection"]});case 41:case"end":return e.stop()}}),e,this,[[18,31]])}))),function(){return t.apply(this,arguments)})},{key:"_destroyCurrentWSConnection",value:function(){this.wsID+=1;try{this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners(),this.ws&&this.ws.close&&this.ws.close()}catch(e){}}},{key:"_startHealthCheck",value:function(){var e=this;this.healthCheckIntervalRef=setInterval((function(){var t=[{type:"health.check",client_id:e.clientID,user_id:e.userID}];try{var n;null===(n=e.ws)||void 0===n||n.send(JSON.stringify(t))}catch(e){}}),e.healthCheckInterval)}},{key:"_startMonitor",value:function(){var e=this,t=this;this.monitorIntervalRef=setInterval((function(){var n=new Date;t.lastEvent&&n.getTime()-t.lastEvent.getTime()>e.healthCheckInterval+1e4&&(e.logger("info","connection:_startMonitor - going to reconnect",{tags:["connection"]}),t._setHealth(!1),t._reconnect())}),t.monitorInterval)}}]),e}();function rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function st(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof t)throw new TypeError("userId should be a string");it({user_id:t},n);throw Error("Unable to find jwt crypto, if you are getting this error is probably because you are trying to generate tokens on browser or React Native (or other environment where crypto functions are not available). Please Note: token should only be generated server-side.")}function at(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={server:!0},r=p({algorithm:"HS256",noTimestamp:!0},t);return null.sign(n,e,r)}function ot(e){var t=e.split(".");if(3!==t.length)return"";var n=t[1],r=h(n);return JSON.parse(r).user_id}function ct(e){return["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",l(JSON.stringify({user_id:e})),"devtoken"].join(".")}function ut(e,t,n){var r=Buffer.from(t,"ascii");return null.createHmac("sha256",r).update(e).digest("hex")===n}var lt=function e(t){var n=this;A(this,e),D(this,"loadTokenPromise",void 0),D(this,"type",void 0),D(this,"secret",void 0),D(this,"token",void 0),D(this,"tokenProvider",void 0),D(this,"user",void 0),D(this,"setTokenOrProvider",function(){var e=I(S.mark((function e(t,r){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.validateToken(t,r),n.user=r,qe(t)&&(n.tokenProvider=t,n.type="provider"),"string"==typeof t&&(n.token=t,n.type="static"),!t&&n.user&&n.secret&&(n.token=st(n.secret,r.id,{},{}),n.type="static"),e.next=7,n.loadToken();case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),D(this,"reset",(function(){n.token=void 0,n.user=void 0,n.loadTokenPromise=null})),D(this,"validateToken",(function(e,t){if(!t||!t.anon||e){if(!n.secret&&!e)throw new Error("User token can not be empty");if(e&&"string"!=typeof e&&!qe(e))throw new Error("user token should either be a string or a function");if("string"==typeof e){if(t.anon&&""===e)return;var r=ot(e);if(null!=e&&(null==r||""===r||r!==t.id))throw new Error("userToken does not have a user_id or is not matching with user.id")}}})),D(this,"tokenReady",(function(){return n.loadTokenPromise})),D(this,"loadToken",(function(){return n.loadTokenPromise=new Promise(function(){var e=I(S.mark((function e(t){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("static"!==n.type){e.next=2;break}return e.abrupt("return",t(n.token));case 2:if(!n.tokenProvider||"string"==typeof n.tokenProvider){e.next=7;break}return e.next=5,n.tokenProvider();case 5:n.token=e.sent,t(n.token);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.loadTokenPromise})),D(this,"getToken",(function(){if(n.token)return n.token;if(n.user&&n.user.anon&&!n.token)return n.token;if(n.secret)return at(n.secret);throw new Error("Both secret and user tokens are not set. Either client.setUser wasn't called or client.disconnect was called")})),D(this,"isStatic",(function(){return"static"===n.type})),this.loadTokenPromise=null,t&&(this.secret=t),this.type="static",this.secret&&(this.token=at(this.secret))};function ht(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ft(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ft(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dt(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vt(e){return"string"==typeof e||e instanceof String}var gt=function(){function e(t,n,r){var i=this;A(this,e),D(this,"_user",void 0),D(this,"activeChannels",void 0),D(this,"anonymous",void 0),D(this,"axiosInstance",void 0),D(this,"baseURL",void 0),D(this,"browser",void 0),D(this,"cleaningIntervalRef",void 0),D(this,"clientID",void 0),D(this,"configs",void 0),D(this,"connecting",void 0),D(this,"connectionEstablishedCount",void 0),D(this,"connectionID",void 0),D(this,"failures",void 0),D(this,"key",void 0),D(this,"listeners",void 0),D(this,"logger",void 0),D(this,"mutedChannels",void 0),D(this,"node",void 0),D(this,"options",void 0),D(this,"secret",void 0),D(this,"setUserPromise",void 0),D(this,"state",void 0),D(this,"tokenManager",void 0),D(this,"user",void 0),D(this,"userAgent",void 0),D(this,"userID",void 0),D(this,"UUID",void 0),D(this,"wsBaseURL",void 0),D(this,"wsConnection",void 0),D(this,"wsPromise",void 0),D(this,"_setupConnection",(function(){return i.UUID=Se(),i.clientID="".concat(i.userID,"--").concat(i.UUID),i.wsPromise=i.connect(),i._startCleaning(),i.wsPromise})),D(this,"_hasConnectionID",(function(){return Boolean(i.connectionID)})),D(this,"setUser",(function(e,t){if(i.userID)throw new Error("Use client.disconnect() before trying to connect as a different user. setUser was called twice.");if(i.userID=e.id,!i.userID)throw new Error('The "id" field on the user is missing');var n=i._setToken(e,t);i._setUser(e);var r=i._setupConnection();return i.anonymous=!1,i.setUserPromise=Promise.all([n,r]).then((function(e){return e[1]})).catch((function(e){throw e})),i.setUserPromise})),D(this,"_setToken",(function(e,t){return i.tokenManager.setTokenOrProvider(t,e)})),D(this,"setAnonymousUser",(function(){i.anonymous=!0,i.userID=Se();var e={id:i.userID,anon:!0};return i._setToken(e,""),i._setUser(e),i._setupConnection()})),D(this,"doAxiosRequest",function(){var e=I(S.mark((function e(t,n,r){var s,a,o,c=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=c.length>3&&void 0!==c[3]?c[3]:{},e.next=3,i.tokenManager.tokenReady();case 3:a=i._enrichAxiosOptions(s),e.prev=4,i._logApiRequest(t,n,r,a),e.t0=t,e.next="get"===e.t0?9:"delete"===e.t0?13:"post"===e.t0?17:"put"===e.t0?21:"patch"===e.t0?25:"options"===e.t0?29:33;break;case 9:return e.next=11,i.axiosInstance.get(n,a);case 11:return o=e.sent,e.abrupt("break",34);case 13:return e.next=15,i.axiosInstance.delete(n,a);case 15:return o=e.sent,e.abrupt("break",34);case 17:return e.next=19,i.axiosInstance.post(n,r,a);case 19:return o=e.sent,e.abrupt("break",34);case 21:return e.next=23,i.axiosInstance.put(n,r,a);case 23:return o=e.sent,e.abrupt("break",34);case 25:return e.next=27,i.axiosInstance.patch(n,r,a);case 27:return o=e.sent,e.abrupt("break",34);case 29:return e.next=31,i.axiosInstance.options(n,a);case 31:return o=e.sent,e.abrupt("break",34);case 33:throw new Error("Invalid request type");case 34:return i._logApiResponse(t,n,o),e.abrupt("return",i.handleResponse(o));case 38:if(e.prev=38,e.t1=e.catch(4),i._logApiError(t,n,e.t1),!e.t1.response){e.next=50;break}if(e.t1.response.data.code!==We.TOKEN_EXPIRED||i.tokenManager.isStatic()){e.next=47;break}return i.tokenManager.loadToken(),e.next=46,i.doAxiosRequest(t,n,r,s);case 46:return e.abrupt("return",e.sent);case 47:return e.abrupt("return",i.handleResponse(e.t1.response));case 50:throw e.t1;case 51:case"end":return e.stop()}}),e,null,[[4,38]])})));return function(t,n,r){return e.apply(this,arguments)}}()),D(this,"dispatchEvent",(function(e){i._handleClientEvent(e);var t=e.cid,n=t?i.activeChannels[t]:void 0;n&&n._handleChannelEvent(e),i._callClientListeners(e),n&&n._callChannelListeners(e)})),D(this,"handleEvent",(function(e){var t=e.data,n=JSON.parse(t);n.received_at=new Date,i.dispatchEvent(n)})),D(this,"_callClientListeners",(function(e){var t=i,n=[];t.listeners.all&&n.push.apply(n,O(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,O(t.listeners[e.type]));for(var r=0,s=n;r<s.length;r++){(0,s[r])(e)}})),D(this,"recoverState",I(S.mark((function e(){var t,n,r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.logger("info","client:recoverState() - Start of recoverState with connectionID ".concat(null===(t=i.wsConnection)||void 0===t?void 0:t.connectionID),{tags:["connection"]}),i.connectionID=null===(n=i.wsConnection)||void 0===n?void 0:n.connectionID,!(r=Object.keys(i.activeChannels)).length){e.next=9;break}return i.logger("info","client:recoverState() - Start the querying of ".concat(r.length," channels"),{tags:["connection","client"]}),e.next=7,i.queryChannels({cid:{$in:r}},{last_message_at:-1},{limit:30});case 7:i.logger("info","client:recoverState() - Querying channels finished",{tags:["connection","client"]}),i.dispatchEvent({type:"connection.recovered"});case 9:i.wsPromise=Promise.resolve(),i.setUserPromise=Promise.resolve();case 11:case"end":return e.stop()}}),e)})))),D(this,"_isUsingServerAuth",(function(){return!!i.secret})),this.key=t,this.listeners={},this.state=new Ye,this.mutedChannels=[],n&&vt(n)&&(this.secret=n);var s=r||(n&&!vt(n)?n:{});this.browser=void 0!==s.browser?s.browser:"undefined"!=typeof window,this.node=!this.browser,this.options=pt({timeout:3e3,withCredentials:!1,warmUp:!1},s),this.node&&(this.options.httpsAgent=new null.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.axiosInstance=we.create(this.options),this.setBaseURL("https://chat-us-east-1.stream-io-api.com"),"undefined"!=typeof process&&process.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030"),this.wsConnection=null,this.wsPromise=null,this.setUserPromise=null,this.activeChannels={},this.configs={},this.anonymous=!1,this.tokenManager=new lt(this.secret),this.logger=qe(s.logger)?s.logger:function(){return null}}var t,n,r,i,s,a,o,c,u,l,h,f,d,g,y,m,b,w,_,x,U,R,E,j,T,P,M,F,B,N,q,W;return L(e,[{key:"devToken",value:function(e){return ct(e)}},{key:"getAuthType",value:function(){return this.anonymous?"anonymous":"jwt"}},{key:"setBaseURL",value:function(e){this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws")}},{key:"_setUser",value:function(e){this.user=e,this._user=pt({},e)}},{key:"updateAppSettings",value:(W=I(S.mark((function e(t){var n;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(null===(n=t.apn_config)||void 0===n?void 0:n.p12_cert)&&(t.apn_config.p12_cert=Buffer.from(t.apn_config.p12_cert).toString("base64")),e.next=3,this.patch(this.baseURL+"/app",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"getAppSettings",value:(q=I(S.mark((function e(){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/app");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return q.apply(this,arguments)})},{key:"testPushSettings",value:(N=I(S.mark((function e(t){var n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/check_push",pt(pt(pt(pt({user_id:t},n.messageID?{message_id:n.messageID}:{}),n.apnTemplate?{apn_template:n.apnTemplate}:{}),n.firebaseTemplate?{firebase_template:n.firebaseTemplate}:{}),n.firebaseDataTemplate?{firebase_data_template:n.firebaseDataTemplate}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"disconnect",value:function(e){this.logger("info","client:disconnect() - Disconnecting the client",{tags:["connection","client"]}),delete this.user,delete this._user,delete this.userID,null!=this.cleaningIntervalRef&&(clearInterval(this.cleaningIntervalRef),this.cleaningIntervalRef=void 0),this.anonymous=!1,this.connectionEstablishedCount=0;for(var t=0,n=Object.values(this.activeChannels);t<n.length;t++){n[t]._disconnect()}return this.activeChannels={},this.state=new Ye,this.tokenManager.reset(),this.wsConnection?this.wsConnection.disconnect(e):Promise.resolve()}},{key:"setGuestUser",value:(B=I(S.mark((function e(t){var n,r,i;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.anonymous=!0,e.prev=1,e.next=4,this.post(this.baseURL+"/guest",{user:t});case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.anonymous=!1,e.t0;case 11:return this.anonymous=!1,(r=n.user).created_at,r.updated_at,r.last_active,r.online,i=C(r,["created_at","updated_at","last_active","online"]),e.next=15,this.setUser(i,n.access_token);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return B.apply(this,arguments)})},{key:"createToken",value:function(e,t){if(null==this.secret)throw Error("tokens can only be created server-side using the API Secret");var n={};return t&&(n.exp=t),st(this.secret,e,n,{})}},{key:"on",value:function(e,t){var n=this,r=t?e:"all";if(!Me(r))throw Error("Invalid event type ".concat(r));var i=t||e;return r in this.listeners||(this.listeners[r]=[]),this.logger("info","Attaching listener for ".concat(r," event"),{tags:["event","client"]}),this.listeners[r].push(i),{unsubscribe:function(){n.listeners[r]=n.listeners[r].filter((function(e){return e!==i}))}}}},{key:"off",value:function(e,t){var n=t?e:"all";if(!Me(n))throw Error("Invalid event type ".concat(n));var r=t||e;n in this.listeners||(this.listeners[n]=[]),this.logger("info","Removing listener for ".concat(n," event"),{tags:["event","client"]}),this.listeners[n]=this.listeners[n].filter((function(e){return e!==r}))}},{key:"_logApiRequest",value:function(e,t,n,r){this.logger("info","client: ".concat(e," - Request - ").concat(t),{tags:["api","api_request","client"],url:t,payload:n,config:r})}},{key:"_logApiResponse",value:function(e,t,n){this.logger("info","client:".concat(e," - Response - url: ").concat(t," > status ").concat(n.status),{tags:["api","api_response","client"],url:t,response:n})}},{key:"_logApiError",value:function(e,t,n){this.logger("error","client:".concat(e," - Error - url: ").concat(t),{tags:["api","api_response","client"],url:t,error:n})}},{key:"get",value:function(e,t){return this.doAxiosRequest("get",e,null,{params:t})}},{key:"put",value:function(e,t){return this.doAxiosRequest("put",e,t)}},{key:"post",value:function(e,t){return this.doAxiosRequest("post",e,t)}},{key:"patch",value:function(e,t){return this.doAxiosRequest("patch",e,t)}},{key:"delete",value:function(e,t){return this.doAxiosRequest("delete",e,null,{params:t})}},{key:"sendFile",value:function(e,t,n,r,i){var s=ze(t,n,r);return null!=i&&s.append("user",JSON.stringify(i)),this.doAxiosRequest("post",e,s,{headers:s.getHeaders?s.getHeaders():{},config:{timeout:0,maxContentLength:1/0,maxBodyLength:1/0}})}},{key:"errorFromResponse",value:function(e){var t;return t=new Error("StreamChat error HTTP code: ".concat(e.status)),e.data&&e.data.code&&((t=new Error("StreamChat error code ".concat(e.data.code,": ").concat(e.data.message))).code=e.data.code),t.response=e,t.status=e.status,t}},{key:"handleResponse",value:function(e){var t=e.data;if("2"!==(e.status+"")[0])throw this.errorFromResponse(e);return t}},{key:"_handleClientEvent",value:function(e){var t,n,r=this;(this.logger("info","client:_handleClientEvent - Received event of type { ".concat(e.type," }"),{tags:["event","client"],event:e}),!e.user||"user.presence.changed"!==e.type&&"user.updated"!==e.type)||((null===(n=e.user)||void 0===n?void 0:n.id)===this.userID&&(this.user=this.user&&pt(pt({},this.user),e.user),Object.keys(e.user).forEach((function(t){r._user&&t in r._user&&(r._user[t]=e.user[t])}))),r.state.updateUser(e.user),r._updateUserReferences(e.user));"health.check"===e.type&&e.me&&(r.user=e.me,r.state.updateUser(e.me),r.mutedChannels=e.me.channel_mutes),e.channel&&"notification.message_new"===e.type&&(this.configs[e.channel.type]=e.channel.config),"notification.channel_mutes_updated"===e.type&&(null===(t=e.me)||void 0===t?void 0:t.channel_mutes)&&(this.mutedChannels=e.me.channel_mutes)}},{key:"_muteStatus",value:function(e){var t;return this.mutedChannels.forEach((function(n){var r;if((null===(r=n.channel)||void 0===r?void 0:r.cid)===e){var i=!0;n.expires&&(i=new Date(n.expires).getTime()>(new Date).getTime()),t={muted:i,createdAt:n.created_at?new Date(n.created_at):new Date,expiresAt:n.expires?new Date(n.expires):null}}})),t||{muted:!1,createdAt:null,expiresAt:null}}},{key:"_updateUserReferences",value:function(e){for(var t=this.state.userChannelReferences[e.id]||{},n=0,r=Object.keys(t);n<r.length;n++){var i=r[n],s=this.activeChannels[i];s&&s.state&&(s.state.members[e.id]&&(s.state.members=s.state.members.setIn([e.id,"user"],e)),s.state.watchers[e.id]&&(s.state.watchers=s.state.watchers.setIn([e.id,"user"],e)))}}},{key:"connect",value:(F=I(S.mark((function e(){var t,n,r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connecting=!0,t=this,this.failures=0,null!=t.userID&&null!=this._user){e.next=5;break}throw Error("Call setUser or setAnonymousUser before starting the connection");case 5:if(null!=t.wsBaseURL){e.next=7;break}throw Error("Websocket base url not set");case 7:if(null!=t.clientID){e.next=9;break}throw Error("clientID is not set");case 9:return this.wsConnection=new nt({wsBaseURL:t.wsBaseURL,clientID:t.clientID,userID:t.userID,tokenManager:t.tokenManager,user:this._user,authType:this.getAuthType(),userAgent:this._userAgent(),apiKey:this.key,recoverCallback:this.recoverState,messageCallback:this.handleEvent,eventCallback:this.dispatchEvent,logger:this.logger}),this.options.warmUp&&(n=this.doAxiosRequest("options",this.baseURL+"/connect")),e.next=13,this.wsConnection.connect();case 13:return r=e.sent,e.prev=14,e.next=17,n;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(14),this.logger("error","Warmup request failed",{error:e.t0});case 22:return this.connectionID=this.wsConnection.connectionID,e.abrupt("return",r);case 24:case"end":return e.stop()}}),e,this,[[14,19]])}))),function(){return F.apply(this,arguments)})},{key:"queryUsers",value:(M=I(S.mark((function e(t){var n,r,i,s,a,o,c,u,l,h,f=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=f.length>1&&void 0!==f[1]?f[1]:{},r=f.length>2&&void 0!==f[2]?f[2]:{},i=[],s=0,a=Object.entries(n);s<a.length;s++)o=k(a[s],2),c=o[0],u=o[1],i.push({field:c,direction:u});return l={presence:!1},e.next=7,this.setUserPromise;case 7:return this._hasConnectionID()||(l.presence=!1),e.next=10,this.get(this.baseURL+"/users",{payload:pt(pt({filter_conditions:t,sort:i},l),r)});case 10:return h=e.sent,this.state.updateUsers(h.users),e.abrupt("return",h);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"queryChannels",value:(P=I(S.mark((function e(t){var n,r,i,s,a,o,c,u,l,h,f,d,p,v,g,y,m,b,w,_=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=_.length>1&&void 0!==_[1]?_[1]:{},r=_.length>2&&void 0!==_[2]?_[2]:{},i=[],s=0,a=Object.entries(n);s<a.length;s++)o=k(a[s],2),c=o[0],u=o[1],i.push({field:c,direction:u});return l={state:!0,watch:!0,presence:!1},e.next=7,this.setUserPromise;case 7:return this._hasConnectionID()||(l.watch=!1),h=pt(pt({filter_conditions:t,sort:i,user_details:this._user},l),r),e.next=11,this.get(this.baseURL+"/channels",{payload:h});case 11:f=e.sent,d=[],p=ht(f.channels);try{for(p.s();!(v=p.n()).done;)g=v.value,this._addChannelConfig(g)}catch(e){p.e(e)}finally{p.f()}y=ht(f.channels);try{for(y.s();!(m=y.n()).done;)b=m.value,(w=this.channel(b.channel.type,b.channel.id)).data=b.channel,w.initialized=!0,w._initializeState(b),d.push(w)}catch(e){y.e(e)}finally{y.f()}return e.abrupt("return",d);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"search",value:(T=I(S.mark((function e(t,n){var r,i,s=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>2&&void 0!==s[2]?s[2]:{},i=pt({filter_conditions:t},r),"string"!=typeof n){e.next=6;break}i.query=n,e.next=11;break;case 6:if("object"!==v(n)){e.next=10;break}i.message_filter_conditions=n,e.next=11;break;case 10:throw Error("Invalid type ".concat(v(n)," for query parameter"));case 11:return e.next=13,this.setUserPromise;case 13:return e.next=15,this.get(this.baseURL+"/search",{payload:i});case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"addDevice",value:(j=I(S.mark((function e(t,n,r){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/devices",pt({id:t,push_provider:n},null!=r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return j.apply(this,arguments)})},{key:"getDevices",value:(E=I(S.mark((function e(t){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/devices",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"removeDevice",value:(R=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/devices",pt({id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"_addChannelConfig",value:function(e){this.configs[e.channel.type]=e.channel.config}},{key:"channel",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.userID&&!this._isUsingServerAuth())throw Error("Call setUser or setAnonymousUser before creating a channel");if(~e.indexOf(":"))throw Error("Invalid channel group ".concat(e,", can't contain the : character"));if(null==t||""===t)return new Ge(this,e,void 0,n);if("object"===v(t))return new Ge(this,e,void 0,t);if("string"==typeof t&&~t.indexOf(":"))throw Error("Invalid channel id ".concat(t,", can't contain the : character"));var r="".concat(e,":").concat(t);if(r in this.activeChannels){var i=this.activeChannels[r];return Object.keys(n).length>0&&(i.data=n,i._data=n),i}var s=new Ge(this,e,t,n);return this.activeChannels[s.cid]=s,s}},{key:"updateUser",value:(U=I(S.mark((function e(t){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upsertUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"partialUpdateUser",value:(x=I(S.mark((function e(t){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.partialUpdateUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"upsertUsers",value:(_=I(S.mark((function e(t){var n,r,i,s;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=ht(t),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=11;break}if((s=i.value).id){e.next=8;break}throw Error("User ID is required when updating a user");case 8:n[s.id]=s;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:return e.next=21,this.post(this.baseURL+"/users",{users:n});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e,this,[[2,13,16,19]])}))),function(e){return _.apply(this,arguments)})},{key:"upsertUser",value:function(e){return this.upsertUsers([e])}},{key:"updateUsers",value:function(e){return this.upsertUsers(e)}},{key:"partialUpdateUsers",value:(w=I(S.mark((function e(t){var n,r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=ht(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}if(r.value.id){e.next=7;break}throw Error("User ID is required when updating a user");case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:return e.next=19,this.patch(this.baseURL+"/users",{users:t});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(e){return w.apply(this,arguments)})},{key:"deleteUser",value:(b=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/users/".concat(t),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return b.apply(this,arguments)})},{key:"reactivateUser",value:(m=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(t,"/reactivate"),pt({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"deactivateUser",value:(y=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(t,"/deactivate"),pt({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"exportUser",value:(g=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/".concat(t,"/export"),pt({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"banUser",value:(d=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/ban",pt({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"unbanUser",value:(f=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/moderation/ban",pt({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"muteUser",value:(h=I(S.mark((function e(t,n){var r,i=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:{},e.next=3,this.post(this.baseURL+"/moderation/mute",pt(pt({target_id:t},n?{user_id:n}:{}),r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"unmuteUser",value:(l=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/unmute",pt({target_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"flagMessage",value:(u=I(S.mark((function e(t){var n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",pt({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"flagUser",value:(c=I(S.mark((function e(t){var n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",pt({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"unflagMessage",value:(o=I(S.mark((function e(t){var n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",pt({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"unflagUser",value:(a=I(S.mark((function e(t){var n,r=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",pt({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"markAllRead",value:(s=I(S.mark((function e(){var t,n=arguments;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/channels/read",pt({},t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"createCommand",value:function(e){return this.post(this.baseURL+"/commands",e)}},{key:"getCommand",value:function(e){return this.get(this.baseURL+"/commands/".concat(e))}},{key:"updateCommand",value:function(e,t){return this.put(this.baseURL+"/commands/".concat(e),t)}},{key:"deleteCommand",value:function(e){return this.delete(this.baseURL+"/commands/".concat(e))}},{key:"listCommands",value:function(){return this.get(this.baseURL+"/commands")}},{key:"createChannelType",value:function(e){var t=p({},{commands:["all"]},e);return this.post(this.baseURL+"/channeltypes",t)}},{key:"getChannelType",value:function(e){return this.get(this.baseURL+"/channeltypes/".concat(e))}},{key:"updateChannelType",value:function(e,t){return this.put(this.baseURL+"/channeltypes/".concat(e),t)}},{key:"deleteChannelType",value:function(e){return this.delete(this.baseURL+"/channeltypes/".concat(e))}},{key:"listChannelTypes",value:function(){return this.get(this.baseURL+"/channeltypes")}},{key:"translateMessage",value:(i=I(S.mark((function e(t,n){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(t,"/translate"),{language:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"updateMessage",value:(r=I(S.mark((function e(t,n){var r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw Error("Please specify the message id when calling updateMessage");case 2:return delete(r=p({},t)).id,["command","created_at","html","latest_reactions","own_reactions","reaction_counts","reply_count","type","updated_at","user"].forEach((function(e){null!=r[e]&&delete r[e]})),null!=n&&(vt(n)?r.user_id=n:r.user={id:n.id}),e.next=9,this.post(this.baseURL+"/messages/".concat(t.id),{message:r});case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"deleteMessage",value:(n=I(S.mark((function e(t,n){var r;return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r={hard:!0}),e.next=4,this.delete(this.baseURL+"/messages/".concat(t),r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getMessage",value:(t=I(S.mark((function e(t){return S.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/messages/".concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_userAgent",value:function(){return this.getUserAgent()}},{key:"getUserAgent",value:function(){return this.userAgent||"stream-chat-javascript-client-".concat(this.node?"node":"browser","-","2.7.0")}},{key:"setUserAgent",value:function(e){this.userAgent=e}},{key:"_enrichAxiosOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{},headers:{},config:{}},t=this._getToken();return pt({params:pt(pt({user_id:this.userID},e.params),{},{api_key:this.key,connection_id:this.connectionID}),headers:pt({Authorization:t,"stream-auth-type":this.getAuthType(),"x-stream-client":this._userAgent()},e.headers)},e.config)}},{key:"_getToken",value:function(){return!this.tokenManager||this.anonymous?null:this.tokenManager.getToken()}},{key:"_startCleaning",value:function(){var e=this;null==this.cleaningIntervalRef&&(this.cleaningIntervalRef=setInterval((function(){for(var t=0,n=Object.values(e.activeChannels);t<n.length;t++){n[t].clean()}}),500))}},{key:"verifyWebhook",value:function(e,t){return!!this.secret&&ut(e,this.secret,t)}},{key:"getPermission",value:function(e){return this.get("".concat(this.baseURL,"/custom_permission/").concat(e))}},{key:"createPermission",value:function(e){return this.post("".concat(this.baseURL,"/custom_permission"),pt({},e))}},{key:"updatePermission",value:function(e,t){return this.post("".concat(this.baseURL,"/custom_permission/").concat(e),pt({},t))}},{key:"deletePermission",value:function(e){return this.delete("".concat(this.baseURL,"/custom_permission/").concat(e))}},{key:"listPermissions",value:function(){return this.get("".concat(this.baseURL,"/custom_permission"))}},{key:"createRole",value:function(e){return this.post("".concat(this.baseURL,"/custom_role"),{name:e})}},{key:"listRoles",value:function(){return this.get("".concat(this.baseURL,"/custom_role"))}},{key:"deleteRole",value:function(e){return this.delete("".concat(this.baseURL,"/custom_role/").concat(e))}},{key:"sync",value:function(e,t){return this.post("".concat(this.baseURL,"/sync"),{channel_cids:e,last_sync_at:t})}},{key:"createBlockList",value:function(e){return this.post("".concat(this.baseURL,"/blocklists"),e)}},{key:"listBlockLists",value:function(){return this.get("".concat(this.baseURL,"/blocklists"))}},{key:"getBlockList",value:function(e){return this.get("".concat(this.baseURL,"/blocklists/").concat(e))}},{key:"updateBlockList",value:function(e,t){return this.put("".concat(this.baseURL,"/blocklists/").concat(e),t)}},{key:"deleteBlockList",value:function(e){return this.delete("".concat(this.baseURL,"/blocklists/").concat(e))}}]),e}(),yt="Allow",mt="Deny",bt=["*"],wt=["*"],kt=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bt,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wt,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:yt;A(this,e),D(this,"name",void 0),D(this,"action",void 0),D(this,"owner",void 0),D(this,"priority",void 0),D(this,"resources",void 0),D(this,"roles",void 0),this.name=t,this.action=a,this.owner=s,this.priority=n,this.resources=r,this.roles=i},_t=new kt("Allow all",999,bt,wt,!1,yt),Ct=new kt("Deny all",1,bt,wt,!1,mt);e.Allow=yt,e.AllowAll=_t,e.AnyResource=bt,e.AnyRole=wt,e.BuiltinPermissions={AddLinks:"Add Links",BanUser:"Ban User",CreateChannel:"Create Channel",CreateMessage:"Create Message",CreateReaction:"Create Reaction",DeleteAnyAttachment:"Delete Any Attachment",DeleteAnyChannel:"Delete Any Channel",DeleteAnyMessage:"Delete Any Message",DeleteAnyReaction:"Delete Any Reaction",DeleteOwnAttachment:"Delete Own Attachment",DeleteOwnChannel:"Delete Own Channel",DeleteOwnMessage:"Delete Own Message",DeleteOwnReaction:"Delete Own Reaction",ReadAnyChannel:"Read Any Channel",ReadOwnChannel:"Read Own Channel",RunMessageAction:"Run Message Action",UpdateAnyChannel:"Update Any Channel",UpdateAnyMessage:"Update Any Message",UpdateMembersAnyChannel:"Update Members Any Channel",UpdateMembersOwnChannel:"Update Members Own Channel",UpdateOwnChannel:"Update Own Channel",UpdateOwnMessage:"Update Own Message",UploadAttachment:"Upload Attachment",UseFrozenChannel:"Send messages and reactions to frozen channels"},e.BuiltinRoles={Admin:"admin",Anonymous:"anonymous",ChannelMember:"channel_member",ChannelModerator:"channel_moderator",Guest:"guest",User:"user"},e.Channel=Ge,e.ChannelState=je,e.CheckSignature=ut,e.ClientState=Ye,e.Deny=mt,e.DenyAll=Ct,e.DevToken=ct,e.EVENT_MAP=Te,e.JWTServerToken=at,e.JWTUserToken=st,e.MaxPriority=999,e.MinPriority=1,e.Permission=kt,e.StableWSConnection=nt,e.StreamChat=gt,e.TokenManager=lt,e.UserFromToken=ot,e.chatCodes=We,e.decodeBase64=h,e.encodeBase64=l,e.isValidEventType=Me,e.logChatPromiseExecution=Be}(this.window=this.window||{});
//# sourceMappingURL=browser.full-bundle.min.js.map
